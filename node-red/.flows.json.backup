[{"id":"4770d184.b6e74","type":"tab","label":"Hue","disabled":false,"info":""},{"id":"96a6cce3.d0aa7","type":"server","name":"Home Assistant","legacy":false,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true},{"id":"85d3c25e.c6e2e","type":"server-events","z":"4770d184.b6e74","name":"HueEvent","server":"96a6cce3.d0aa7","event_type":"deconz_event","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":60,"y":300,"wires":[["2d6db6c.937f94a","b37016e3.f35878"]]},{"id":"b37016e3.f35878","type":"switch","z":"4770d184.b6e74","name":"Hue Dimmer Switch","property":"payload.event.id","propertyType":"msg","rules":[{"t":"eq","v":"hue_dimmer_essbereich","vt":"str"},{"t":"eq","v":"hue_dimmer_wohnzimmer","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":320,"y":300,"wires":[[],["8fcadff6.b3312"]]},{"id":"2d6db6c.937f94a","type":"debug","z":"4770d184.b6e74","name":"HueEvent - Debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":310,"y":460,"wires":[]},{"id":"8fcadff6.b3312","type":"switch","z":"4770d184.b6e74","name":"Arbeitszimmer (Test)","property":"payload.event.event","propertyType":"msg","rules":[{"t":"eq","v":"1000","vt":"num"},{"t":"eq","v":"1001","vt":"num"},{"t":"eq","v":"1002","vt":"num"},{"t":"eq","v":"1003","vt":"str"},{"t":"eq","v":"2000","vt":"str"},{"t":"eq","v":"2001","vt":"str"},{"t":"eq","v":"2002","vt":"str"},{"t":"eq","v":"2003","vt":"str"},{"t":"eq","v":"3000","vt":"str"},{"t":"eq","v":"3001","vt":"str"},{"t":"eq","v":"3002","vt":"str"},{"t":"eq","v":"3003","vt":"str"},{"t":"eq","v":"4000","vt":"str"},{"t":"eq","v":"4001","vt":"str"},{"t":"eq","v":"4002","vt":"str"},{"t":"eq","v":"4003","vt":"str"}],"checkall":"true","repair":false,"outputs":16,"x":680,"y":320,"wires":[[],[],["7eeabc3d.1af294","4ca9ea91.65e804"],["c885c29d.6dff4"],[],[],["f0fa976d.d4cb28"],[],[],["918f40b5.b65d1"],["36546d90.3139d2"],[],["46b795fd.4c28ec"],[],["99c42522.7511d8"],["b091bb2a.6466e8"]],"info":"**Hue Dimmer Switch: Command palette**\r\n\r\n1000=Button(ON) INITIAL_PRESSED\r\n1001=Button(ON) HOLD\r\n1002=Button(ON) SHORT RELEASED\r\n1003=Button(ON) LONG RELEASED\r\n\r\n2000=Button(DIM UP) INITIAL_PRESSED\r\n2001=Button(DIM UP) HOLD\r\n2002=Button(DIM UP) SHORT RELEASED\r\n2003=Button(DIM UP) LONG RELEASED\r\n\r\n3000=Button(DIM DOWN) INITIAL_PRESSED\r\n3001=Button(DIM DOWN) HOLD\r\n3002=Button(DIM DOWN) SHORT RELEASED\r\n3003=Button(DIM DOWN) LONG RELEASED\r\n\r\n4000=Button(OFF) INITIAL_PRESSED\r\n4001=Button(OFF) HOLD\r\n4002=Button(OFF) SHORT RELEASED\r\n4003=Button(OFF) LONG RELEASED"},{"id":"99c42522.7511d8","type":"api-call-service","z":"4770d184.b6e74","name":"Light off (fast)","server":"96a6cce3.d0aa7","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.arbeitszimmer_hue_play","data":"{\"transition\": 1.0}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1300,"y":520,"wires":[[]]},{"id":"4321ba5b.657da4","type":"api-call-service","z":"4770d184.b6e74","name":"scenes.service","server":"96a6cce3.d0aa7","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"","data":"{\t   \"entity_id\": msg.payload,\t   \"transition\": 1\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1500,"y":180,"wires":[[]]},{"id":"16d011dd.b7f84e","type":"debug","z":"4770d184.b6e74","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","statusVal":"","statusType":"auto","x":1325,"y":50,"wires":[]},{"id":"7eeabc3d.1af294","type":"counter","z":"4770d184.b6e74","name":"idx.counter","init":"-1","step":"1","lower":"-1","upper":"5","mode":"increment","outputs":"1","x":930,"y":100,"wires":[["4973da6b.2b45b4"]]},{"id":"44d89528.1952ec","type":"change","z":"4770d184.b6e74","name":"idx.reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"-1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":160,"wires":[["7eeabc3d.1af294"]]},{"id":"4973da6b.2b45b4","type":"switch","z":"4770d184.b6e74","name":"idx.scene","property":"count","propertyType":"msg","rules":[{"t":"eq","v":"-1","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1100,"y":100,"wires":[[],["44d89528.1952ec"],["16d011dd.b7f84e","9bfc8ef6.375c6"]]},{"id":"f1548385.c99fc","type":"debug","z":"4770d184.b6e74","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1450,"y":120,"wires":[]},{"id":"9bfc8ef6.375c6","type":"function","z":"4770d184.b6e74","name":"scenes.array","func":"const startup_scene = \"scene.licht_arbeitszimmer_neutral\";\nconst additional_scenes = [\n    \"scene.licht_arbeitszimmer_kalt\",\n    \"scene.licht_arbeitszimmer_warm\",\n    \"scene.licht_arbeitszimmer_entspannt\",\n    \"scene.licht_arbeitszimmer_rot\",\n    \"scene.licht_arbeitszimmer_blau\",\n] || []; // && to exclude, || to include additional scenes\n\nconst scenes = [\n    startup_scene\n    , ...additional_scenes\n];\n\nvar payload = scenes[msg.count % scenes.length]\n\nreturn {payload: payload};\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":160,"wires":[["4321ba5b.657da4","f1548385.c99fc"]]},{"id":"4ca9ea91.65e804","type":"trigger","z":"4770d184.b6e74","name":"idx.timer","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1020,"y":200,"wires":[["44d89528.1952ec"]]},{"id":"872df983.613bc8","type":"api-call-service","z":"4770d184.b6e74","name":"scene.before","server":"96a6cce3.d0aa7","version":1,"debugenabled":false,"service_domain":"scene","service":"create","entityId":"","data":"{\t    \"scene_id\": \"before_dimming\",\t    \"snapshot_entities\": \"light.arbeitszimmer_hue_play\"\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1230,"y":760,"wires":[[]]},{"id":"b091bb2a.6466e8","type":"api-call-service","z":"4770d184.b6e74","name":"Light off (slow)","server":"96a6cce3.d0aa7","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.arbeitszimmer_hue_play","data":"{\"transition\": 5.0}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1300,"y":580,"wires":[[]]},{"id":"46b795fd.4c28ec","type":"api-current-state","z":"4770d184.b6e74","name":"","server":"96a6cce3.d0aa7","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.arbeitszimmer_hue_play","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1010,"y":380,"wires":[[],["44d89528.1952ec"]]},{"id":"c885c29d.6dff4","type":"api-call-service","z":"4770d184.b6e74","name":"scenes.colorloop","server":"96a6cce3.d0aa7","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.arbeitszimmer_hue_play","data":"{\t   \"transition\": 2.0,\t   \"brightness_pct\":95,\t   \"effect\":\"colorloop\"\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1510,"y":260,"wires":[[]]},{"id":"f0fa976d.d4cb28","type":"api-current-state","z":"4770d184.b6e74","name":"Arbeitszimmer","server":"96a6cce3.d0aa7","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.arbeitszimmer_hue_play","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":920,"y":300,"wires":[["a8e30f6f.7705c","848d99b2.62c2a8"]]},{"id":"848d99b2.62c2a8","type":"function","z":"4770d184.b6e74","name":"Dim up","func":"varBright = msg.data.attributes.brightness;\nvarEntity = msg.data.entity_id;\n\nif (varBright < 245) {varBrightness = varBright + 50}\nelse {varBrightness = 254}\nmsg.payload = {\"entity_id\":varEntity}\nmsg.payload.data = {\"brightness\":varBrightness}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1260,"y":300,"wires":[["b917dae8.9fd2f8"]]},{"id":"b917dae8.9fd2f8","type":"api-call-service","z":"4770d184.b6e74","name":"","server":"96a6cce3.d0aa7","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"","data":"{\t    \"entity_id\": payload.entity_id,\t    \"brigthness\": payload.brigthness\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1510,"y":320,"wires":[[]]},{"id":"a8e30f6f.7705c","type":"debug","z":"4770d184.b6e74","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1270,"y":440,"wires":[]},{"id":"7c40200c.ffd67","type":"function","z":"4770d184.b6e74","name":"Dim down","func":"varBright = msg.data.attributes.brightness;\nvarEntity = msg.data.entity_id;\n\nif (varBright > 15) {varBrightness = varBright - 50}\nelse {varBrightness = 2}\nmsg.payload = {\"entity_id\":varEntity}\nmsg.payload.data = {\"brightness\":varBrightness}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1260,"y":340,"wires":[["b917dae8.9fd2f8"]]},{"id":"fbc95fc8.9bfd4","type":"function","z":"4770d184.b6e74","name":"Dimming","func":"varBright = msg.data.attributes.brightness;\nvarEntity = msg.data.entity_id;\nconst increase = 50\n\nif (msg.payload.event.event == 2002) {\n    if (varBright < 245) {\n        varBrightness = varBright + increase\n    }\n    else {\n        varBrightness = 254\n    }\n}\nelse {\n    if (varBright > 15) {\n        varBrightness = varBright - increase\n    }\n    else {\n        varBrightness = 2\n    } \n}\n\nmsg.payload = {\"entity_id\":varEntity}\nmsg.payload.data = {\"brightness\":varBrightness} \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1560,"y":680,"wires":[[]]},{"id":"36546d90.3139d2","type":"api-current-state","z":"4770d184.b6e74","name":"Arbeitszimmer","server":"96a6cce3.d0aa7","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.arbeitszimmer_hue_play","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":920,"y":340,"wires":[["7c40200c.ffd67"]]},{"id":"918f40b5.b65d1","type":"api-current-state","z":"4770d184.b6e74","name":"Arbeitszimmer","server":"96a6cce3.d0aa7","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.arbeitszimmer_hue_play","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":920,"y":580,"wires":[["6aef0359.22a09c"]]},{"id":"6aef0359.22a09c","type":"function","z":"4770d184.b6e74","name":"Dim down","func":"varBright = msg.data.attributes.brightness;\nvarEntity = msg.data.entity_id;\n\nif (varBright > 15) {varBrightness = varBright - 15}\nelse {varBrightness = 2}\nmsg.payload = {\"entity_id\":varEntity}\nmsg.payload.data = {\"brightness_step_pct\": \"-15\"}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":580,"wires":[["94ea1541.08cd48"]]},{"id":"94ea1541.08cd48","type":"api-call-service","z":"4770d184.b6e74","name":"","server":"96a6cce3.d0aa7","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"","data":"{\t    \"entity_id\": payload.entity_id,\t    \"brigthness_step_pct\": payload.brightness_step_pct\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1290,"y":660,"wires":[[]]}]